# This sweep tests whether sweeps for a selection of objects produce the
# correct values when there is a sweep on the same parameter for a larger
# scope. That is:
#
# `sweep unrolling for ** from 1 to 4 expstep` should be applied to all loops
# except for those under aes_aes.aes256_encrypt_ecb, which have their own sweep
# commands and come after the sweep on **.

begin sweep mysweep

use xenon.tests.machsuite

generate configs

# Set parameters.
set output_dir "test"
set source_dir "test"
set simulator "aladdin"
set memory_type "spad"

set pipelining 1
set partition_type "cyclic"
set partition_type for aes_aes.k "block"
sweep unrolling for ** from 1 to 4 expstep 2
sweep unrolling for aes_aes.aes256_encrypt_ecb.* from 2 to 8 expstep 2
sweep unrolling for aes_aes.aes256_encrypt_ecb.ecb2 from 1 to 3 linstep 1

end sweep


# Same sweep as above, but we've put the more selective sweep command before
# the global one.  The global one should override the more selective one.
begin sweep mysweep2

use xenon.tests.machsuite

generate configs

# Set parameters.
set output_dir "test"
set source_dir "test"
set simulator "aladdin"
set memory_type "spad"

set pipelining 1
set partition_type "cyclic"
set partition_type for aes_aes.k "block"
sweep unrolling for aes_aes.aes256_encrypt_ecb.* from 2 to 8 expstep 2
sweep unrolling for aes_aes.aes256_encrypt_ecb.ecb2 from 1 to 3 linstep 1
sweep unrolling for ** from 1 to 4 expstep 2

end sweep

# Same sweep as above, but now we set a few parameters to constant values.
# after all the sweep commands.
begin sweep mysweep3

use xenon.tests.machsuite

generate configs

# Set parameters.
set output_dir "test"
set source_dir "test"
set simulator "aladdin"
set memory_type "spad"

set pipelining 1
set partition_type "cyclic"
set partition_type for aes_aes.k "block"
sweep unrolling for aes_aes.aes256_encrypt_ecb.* from 2 to 8 expstep 2
sweep unrolling for aes_aes.aes256_encrypt_ecb.ecb2 from 1 to 3 linstep 1
sweep unrolling for ** from 1 to 4 expstep 2
set unrolling for aes_aes.aes256_encrypt_ecb.ecb2 10
set unrolling for aes_aes.aes_subBytes.sub 12


end sweep
